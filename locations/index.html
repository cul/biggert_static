<!DOCTYPE html>
<html lang="en-us">
  <head>
  <!-- Canonical link to help search engines -->
  <link rel="canonical" href="/ldpd-biggert/locations/"/>
  <link rel=icon href="/ldpd-biggert/assets/logo.png">
  <!-- Basic meta elements -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <meta name="description" content="">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>

  <title>
    
      Browse by Location
    
  </title>

  <!-- styles -->
  <link rel="stylesheet" href="/ldpd-biggert/assets/wax.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- jquery -->
  <script type='text/javascript' id="jquery" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
  <!--ldpd toolkit -->
  <script type='text/javascript' id="jquery-migrate" src="//code.jquery.com/jquery-migrate-3.0.0.min.js"></script>
  <script type="text/javascript">CULh_colorfg = '#303030';CULh_colorbg = '#303030';</script>
  <script type='text/javascript' id="ldpd-toolkit" src="//cdn.cul.columbia.edu/ldpd-toolkit/widgets/cultnbw.min.js"></script>
</head>

  <body>
    <header class="container-fluid" id="header-block" role="banner">
  <div class="container">
    <nav class="navbar navbar-light nopadding">
      <p id="title">
        <a href="/ldpd-biggert/" class="navbar-brand d-flex" title="Home">
          <span class="icon baseline logo"></span>
          The Biggert Collection of Architectural Vignettes
        </a>
      </p>
      <div id="wax-navbar">
        <ul class="nav ml-auto list-inline nomargin">
          
            
            <li class="nav-item dropdown nopadding">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About&nbsp;&nbsp;&nbsp;/
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                <a class="dropdown-item" href="/ldpd-biggert/about-the-collection/">About the Collection</a>
                
                <a class="dropdown-item" href="/ldpd-biggert/rights/">Rights & Permissions</a>
                
              </div>
            </li>
            
          
            
            <li class="nav-item nopadding">
              <a class="nav-link" href="/ldpd-biggert/locations/">Browse the Map&nbsp;&nbsp;&nbsp;/</a>
            </li>
            
          
            
            <li class="nav-item nopadding">
              <a class="nav-link" href="/ldpd-biggert/search/">Search</a>
            </li>
            
          
        </ul>
      </div>
    </nav>
  </div>
</header>

    <section class="container" id="main" role="main">
      <h3 class="page-title">Browse by Location</h3>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
<script id="leaflet" src="//unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css"/>
<script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
<script src="/ldpd-biggert/js/lunr-ranges.js"></script>
<div id="map-viewer"></div>
<script>
  $.getJSON("/ldpd-biggert/js/lunr-index.json", function(json_store) {
   // create elasticlunr index
    window.index = new elasticlunr.Index;
    window.store = json_store;
    index.saveDocument(false);
    index.setRef('lunr_id');
    index.addField('title');
    index.addField('coordinates');
    index.addField('link');
    index.addField('thumbnail');
    index.addField('lat');
    index.addField('lon');

    console.log(store.length);
    // add docs
    for (i in store) {
      var doc = elasticlunrRanges.splitCoords(store[i]);
      doc['lunr_id'] = i;
      index.addDoc(doc);
    }

    // map and tile layer
    window.map_viewer;
    map_viewer = L.map('map-viewer', {
      center: [39.44,-98.70],
      zoom: 4
    });
    L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}.{ext}', {
    	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    	subdomains: 'abcd',
    	minZoom: 0,
    	maxZoom: 18,
    	ext: 'png'
    }).addTo(map_viewer);
    L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      minZoom: 0,
      maxZoom: 18,
      ext: 'png'
    }).addTo(map_viewer);

    // markers
    elasticlunrRanges.placeMarkers(map_viewer, index, store);
    elasticlunrRanges.decorateMap(map_viewer, index, store);
  });
  $('.map-link').click(function(){
    console.log('here');
    var coordinate = $(this).attr('data-coordinate').split(",");
    map_viewer.setView(coordinate, 12);
  });
</script>


<h4>Top Locations</h4>
<p>Click on a location below to recenter the map above.</p>

<div id="metadata-block">
  <table class="table table-striped" id="locations">
    <th>Location</th>
    <th>Item Count</th>
  </table>
</div>


<script>
  // set location box to checked by default on search
  $(document).ready(function() {
    $('#location-check').prop('checked', true);
    var groupBy = function(xs, key) {
      return xs.reduce(function(rv, x) {
        (rv[x[key]] = rv[x[key]] || []).push(x);
        return rv;
      }, {});
    };

    // add top locations to table
    window.location_sort = []
    window.top_ten

    $.getJSON("/ldpd-biggert/js/lunr-index.json", function(data) {
      location_data = groupBy(data, 'subject_hierarchical_geographic');
      for (name in location_data){
        num = location_data[name].length;
        coords = location_data[name][0].coordinates;
        location_sort.push({ 'name': name, 'num': num, 'coords': coords });
      }
      location_sort = location_sort.sort(function(a,b) {return (a.num < b.num) ? 1 : ((b.num < a.num) ? -1 : 0);} );
      top_ten = location_sort.slice(0,10);
      for (i in top_ten){
        $("#locations").append("<tr class='meta'><td><a class='map-link' data-coordinate='" + top_ten[i].coords + "'>" + top_ten[i].name + "</a></td><td>" + top_ten[i].num + "</td></tr>");
      }
      $('.map-link').click(function(){
        var coordinate = $(this).attr('data-coordinate').split(",");
        map_viewer.setView(coordinate, 12);
      });
    });
  })
</script>


    </section>
    <footer class="container-fluid" role="contentinfo">
  <div class="container">
    <div class="float-left">Â© Columbia University Libraries</div>
    <div class="float-right">Presented by the Avery Architectural & Fine Arts Library</div>
  </div>
</footer>

  </body>
  <!-- bootstrap -->
  <script type='text/javascript' id="bootstrap" src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script type='text/javascript' id="popper" src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <!-- wax js for banners -->
  <script type="text/javascript" src="/ldpd-biggert/js/wax.js"></script>
</html>
